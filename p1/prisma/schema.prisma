// VibeCheck - Connections (friends, family) for auto-invite
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  avatar    String?
  createdAt DateTime @default(now())

  // Events I organize
  organizedEvents Event[] @relation("Organizer")
  // Events I'm invited to (many-to-many)
  participantIn   Event[] @relation("EventParticipants")
  // My connections (friends, family)
  connectionsFrom Connection[] @relation("ConnectionFrom")
  connectionsTo   Connection[] @relation("ConnectionTo")
}

model Connection {
  id        String   @id @default(cuid())
  type      String   // "friend" | "family"
  createdAt DateTime @default(now())

  fromUserId String
  fromUser   User   @relation("ConnectionFrom", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUserId   String
  toUser     User   @relation("ConnectionTo", fields: [toUserId], references: [id], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([fromUserId])
  @@index([toUserId])
}

model Event {
  id          String   @id @default(cuid())
  title       String
  vibe        String?
  description String?
  location    String?
  locationLat Float?
  locationLng Float?
  startDate   DateTime
  endDate     DateTime
  timezone    String   @default("UTC")
  isInviteOnly Boolean @default(false)
  createdAt   DateTime @default(now())

  organizerId String
  organizer   User     @relation("Organizer", fields: [organizerId], references: [id], onDelete: Cascade)
  participants User[]  @relation("EventParticipants")

  @@index([organizerId])
  @@index([startDate])
}
